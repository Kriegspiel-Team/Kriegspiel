package com.sample
 
import com.sample.Board;
import java.util.ArrayList;
import java.util.List;
import com.sample.Coord;
import com.sample.MovableEntity;
 
rule "Movement"
	agenda-group "Movement"
	no-loop
	when
		b : Board(myBoard : board)
	then
	
		for(int i=0; i<Board.HEIGHT; i++){
			for(int j=0; j<Board.WIDTH; j++){
			
				if (myBoard[i][j] instanceof MovableEntity){

					MovableEntity entity = (MovableEntity)myBoard[i][j];
					int speed = entity.getSpeed();
					entity.resetPossibleMovement();

					List<Coord> possibleMovements = new ArrayList<Coord>();

					possibleMovements.add(new Coord(i,j));
					for(int s = 0; s<speed; s++)
					{
						for(Coord c : possibleMovements){
							for(int k=-1; k<=1; k++){
								for(int l=-1; l<=1; l++){
								
									if (b.isValidSquare(c.x+k, c.y+l)){
										entity.addPossibleMovement(new Coord(c.x+k, c.y+l));
									}
								}
							}
						}
						
						possibleMovements = (ArrayList<Coord>)entity.getPossibleMovement().clone();
					}
				}
			}
		}
end